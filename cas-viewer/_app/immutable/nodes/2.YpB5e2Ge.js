var ge=n=>{throw TypeError(n)};var Ae=(n,e,t)=>e.has(n)||ge("Cannot "+t);var E=(n,e,t)=>(Ae(n,e,"read from private field"),t?t.call(n):e.get(n)),I=(n,e,t)=>e.has(n)?ge("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);import{c as V,a as P,t as U}from"../chunks/BZ6xmyaO.js";import{j as O,y as ae,t as Te,ae as ke,P as He,I as Ne,e as Ve,z as Ze,g as m,ah as Ue,a9 as je,aa as ye,x as oe,k as W,A as Be,ab as ze,h as Ee,ac as Ye,at as de,F as Re,J as _e,au as qe,ak as Ge,a3 as we,av as Je,aw as Ke,D as We,ax as Xe,i as Qe,ay as pe,az as $e,v as et,O as tt,p as B,u as y,d as D,a as Y,f as z,n as q,s as M,R as X,S as N,$ as at,b as A,c as C}from"../chunks/CZe3Kxqk.js";import{r as j,p as Z,s as ne,a as T,i as xe}from"../chunks/itrhlFoH.js";import{l as rt,d as nt,e as R}from"../chunks/Dsm-fUL-.js";import{g as se,s as F,b as he,c as st,p as it,d as lt,e as ot,r as k,m as dt,f as ue,x as ut,V as ct,a as ft,M as vt,P as mt}from"../chunks/DcAryYuV.js";import{s as G}from"../chunks/B0dNyDaT.js";import{a as ie}from"../chunks/Dperld0U.js";function be(n,e){O&&ae(Te(n)),ke(()=>{var t=e();for(var a in t){var i=t[a];i?n.style.setProperty(a,i):n.style.removeProperty(a)}}),He(()=>{n.remove()})}function ht(n,e){return e}function gt(n,e,t,a){for(var i=[],r=e.length,s=0;s<r;s++)Ke(e[s].e,i,!0);var v=r>0&&i.length===0&&t!==null;if(v){var f=t.parentNode;We(f),f.append(t),a.clear(),H(n,e[0].prev,e[r-1].next)}Xe(i,()=>{for(var h=0;h<r;h++){var o=e[h];v||(a.delete(o.k),H(n,o.prev,o.next)),Qe(o.e,!v)}})}function yt(n,e,t,a,i,r=null){var s=n,v={flags:e,items:new Map,first:null};{var f=n;s=O?ae(Te(f)):f.appendChild(Ne())}O&&Ze();var h=null,o=!1,d=Ue(()=>{var l=t();return tt(l)?l:l==null?[]:Re(l)});Ve(()=>{var l=m(d),u=l.length;if(o&&u===0)return;o=u===0;let c=!1;if(O){var x=s.data===je;x!==(u===0)&&(s=ye(),ae(s),oe(!1),c=!0)}if(O){for(var S=null,_,w=0;w<u;w++){if(W.nodeType===8&&W.data===Be){s=W,c=!0,oe(!1);break}var g=l[w],b=a(g,w);_=Me(W,v,S,null,g,b,w,i,e,t),v.items.set(b,_),S=_}u>0&&ae(ye())}O||_t(l,v,s,i,e,a,t),r!==null&&(u===0?h?ze(h):h=Ee(()=>r(s)):h!==null&&Ye(h,()=>{h=null})),c&&oe(!0),m(d)}),O&&(s=W)}function _t(n,e,t,a,i,r,s){var v=n.length,f=e.items,h=e.first,o=h,d,l=null,u=[],c=[],x,S,_,w;for(w=0;w<v;w+=1){if(x=n[w],S=r(x,w),_=f.get(S),_===void 0){var g=o?o.e.nodes_start:t;l=Me(g,e,l,l===null?e.first:l.next,x,S,w,a,i,s),f.set(S,l),u=[],c=[],o=l.next;continue}if(wt(_,x,w),_.e.f&de&&ze(_.e),_!==o){if(d!==void 0&&d.has(_)){if(u.length<c.length){var b=c[0],L;l=b.prev;var J=u[0],K=u[u.length-1];for(L=0;L<u.length;L+=1)Le(u[L],b,t);for(L=0;L<c.length;L+=1)d.delete(c[L]);H(e,J.prev,K.next),H(e,l,J),H(e,K,b),o=b,l=K,w-=1,u=[],c=[]}else d.delete(_),Le(_,o,t),H(e,_.prev,_.next),H(e,_,l===null?e.first:l.next),H(e,l,_),l=_;continue}for(u=[],c=[];o!==null&&o.k!==S;)o.e.f&de||(d??(d=new Set)).add(o),c.push(o),o=o.next;if(o===null)continue;_=o}u.push(_),l=_,o=_.next}if(o!==null||d!==void 0){for(var le=d===void 0?[]:Re(d);o!==null;)o.e.f&de||le.push(o),o=o.next;var Oe=le.length;if(Oe>0){var De=v===0?t:null;gt(e,le,De,f)}}_e.first=e.first&&e.first.e,_e.last=l&&l.e}function wt(n,e,t,a){qe(n.v,e),n.i=t}function Me(n,e,t,a,i,r,s,v,f,h){var o=(f&pe)!==0,d=(f&$e)===0,l=o?d?Ge(i):we(i):i,u=f&Je?we(s):s,c={i:u,v:l,k:r,a:null,e:null,prev:t,next:a};try{return c.e=Ee(()=>v(n,l,u,h),O),c.e.prev=t&&t.e,c.e.next=a&&a.e,t===null?e.first=c:(t.next=c,t.e.next=c.e),a!==null&&(a.prev=c,a.e.prev=c.e),c}finally{}}function Le(n,e,t){for(var a=n.next?n.next.e.nodes_start:t,i=e?e.e.nodes_start:t,r=n.e.nodes_start;r!==a;){var s=et(r);i.before(r),r=s}}function H(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function ce(n,e,t=e){rt(n,"change",()=>{t(n.files)}),O&&n.files&&t(n.files),ke(()=>{n.files=e()})}function xt(n,e){B(e,!0);let t=j(e,["$$slots","$$events","$$legacy","source"]);const a=se();if(!a.map)throw new Error("Map instance is not initialized.");const i=D(()=>e.source??he().id);y(()=>{a.userTerrain=F({...t,source:m(i)}),a.waitForStyleLoaded(r=>{r.setTerrain(a.userTerrain||null)})}),ie(()=>{a.userTerrain=void 0,a.waitForStyleLoaded(r=>{r.setTerrain(a.baseTerrain??null)})}),Y()}function Fe(n,e){B(e,!0);let t=Z(e,"source",15,void 0),a=j(e,["$$slots","$$events","$$legacy","source","id","children"]);a=a;const i=se();if(!i.map)throw new Error("Map instance is not initialized.");let r=!0;const s=e.id??st(),v=it();v.id=s,i.waitForStyleLoaded(o=>{i.addSource(s,F(a)),t(o.getSource(s)),r=!0}),y(()=>{t()&&e.type!=="canvas"&&e.type!=="video"&&e.type!=="image"&&(t(t().maxzoom=e.maxzoom??22,!0),e.type!=="geojson"&&t(t().minzoom=e.minzoom??0,!0))}),y(()=>{t()&&(e.type==="vector"||e.type==="raster"||e.type==="raster-dem")&&(e.tiles,!r&&"setTiles"in t()&&t().setTiles(e.tiles??[]))}),y(()=>{t()&&(e.type==="vector"||e.type==="raster"||e.type==="raster-dem")&&(e.url,!r&&"setUrl"in t()&&t().setUrl(e.url))}),y(()=>{t()&&e.type==="image"&&(e.url,r||t().updateImage({url:e.url}))}),y(()=>{if(t()&&(e.type==="image"||e.type==="video"||e.type==="canvas")&&(e.coordinates,!r)){if(!("setCoordinates"in t()))throw new Error("setCoordinates method is not supported");t().setCoordinates(e.coordinates)}}),y(()=>{if(e.type==="canvas"&&(e.animate,t()&&e.animate!==void 0&&!r)){const o=t();e.animate?o.play():o.pause()}}),y(()=>{t()&&e.type==="geojson"&&(e.data,r||t().setData(e.data))}),y(()=>{t()&&e.type==="geojson"&&(e.cluster,e.clusterMaxZoom,e.clusterRadius,r||(e.clusterRadius!==void 0&&t(t().workerOptions.superclusterOptions.radius=e.clusterRadius*(8192/t().tileSize),!0),t().setClusterOptions({cluster:e.cluster,clusterMaxZoom:e.clusterMaxZoom})))}),y(()=>{t(),r=!1}),ie(()=>{i.removeSource(s),t(void 0)});var f=V(),h=z(f);G(h,()=>e.children??q),P(n,f),Y()}function Se(n,e){let t=Z(e,"source",15,void 0),a=j(e,["$$slots","$$events","$$legacy","source","id","children"]);Fe(n,ne({get id(){return e.id},type:"raster"},()=>a,{get source(){return t()},set source(i){t(i)},children:(i,r)=>{var s=V(),v=z(s);G(v,()=>e.children??q),P(i,s)},$$slots:{default:!0}}))}function Ce(n,e){let t=Z(e,"source",15,void 0),a=j(e,["$$slots","$$events","$$legacy","source","id","children"]);Fe(n,ne({get id(){return e.id},type:"raster-dem"},()=>a,{get source(){return t()},set source(i){t(i)},children:(i,r)=>{var s=V(),v=z(s);G(v,()=>e.children??q),P(i,s)},$$slots:{default:!0}}))}function Ie(n,e){B(e,!0);const t=se();if(!t.map)throw new Error("Map instance is not initialized.");const a=e.id??lt(),i=ot();i.id=a;const r={id:a,type:e.type,layout:F(e.layout)??{},paint:F(e.paint)??{}};r.type!=="background"&&(r.source=e.source??he().id),e.maxzoom!==void 0&&(r.maxzoom=e.maxzoom),e.minzoom!==void 0&&(r.minzoom=e.minzoom),e.metadata!==void 0&&(r.metadata=e.metadata),r.type!=="background"&&(e["source-layer"]&&(r["source-layer"]=e["source-layer"]),e.filter&&(r.filter=F(e.filter)));let s=!0;t.waitForStyleLoaded(()=>{t.addLayer(r,e.beforeId)}),y(()=>k(t.map,"click",a,e.onclick)),y(()=>k(t.map,"dblclick",a,e.ondblclick)),y(()=>k(t.map,"mousedown",a,e.onmousedown)),y(()=>k(t.map,"mouseup",a,e.onmouseup)),y(()=>k(t.map,"mousemove",a,e.onmousemove)),y(()=>k(t.map,"mouseenter",a,e.onmouseenter)),y(()=>k(t.map,"mouseleave",a,e.onmouseleave)),y(()=>k(t.map,"mouseover",a,e.onmouseover)),y(()=>k(t.map,"mouseout",a,e.onmouseout)),y(()=>k(t.map,"contextmenu",a,e.oncontextmenu)),y(()=>k(t.map,"touchstart",a,e.ontouchstart)),y(()=>k(t.map,"touchend",a,e.ontouchend)),y(()=>k(t.map,"touchcancel",a,e.ontouchcancel));let v=F(e.paint)??{};y(()=>{e.paint,s||t.waitForStyleLoaded(d=>{const l=new Set(Object.keys(v)),u=F(e.paint)??{};for(const[c,x]of Object.entries(u))l.delete(c),v[c]!==x&&d.setPaintProperty(a,c,x);for(const c of l)d.setPaintProperty(a,c,void 0);v=u})});let f=F(e.layout)??{};y(()=>{e.layout,s||t.waitForStyleLoaded(d=>{const l=new Set(Object.keys(f)),u=F(e.layout)??{};for(const[c,x]of Object.entries(u))l.delete(c),f[c]!==x&&d.setLayoutProperty(a,c,x);for(const c of l)d.setLayoutProperty(a,c,void 0);f=u})}),y(()=>{(e.minzoom!==void 0||e.maxzoom!==void 0)&&!s&&t.waitForStyleLoaded(d=>{d.setLayerZoomRange(a,e.minzoom??0,e.maxzoom??22)})}),y(()=>{e.filter,s||t.waitForStyleLoaded(d=>{d.setFilter(a,F(e.filter))})}),y(()=>{e.beforeId&&!s&&t.waitForStyleLoaded(d=>{d.moveLayer(a,e.beforeId)})}),y(()=>{s=!1}),ie(()=>{t.removeLayer(a)});var h=V(),o=z(h);G(o,()=>e.children??q),P(n,h),Y()}function Pe(n,e){let t=j(e,["$$slots","$$events","$$legacy","children","sourceLayer"]);Ie(n,ne({type:"raster",get"source-layer"(){return e.sourceLayer}},()=>t,{children:(a,i)=>{var r=V(),s=z(r);G(s,()=>e.children??q),P(a,r)},$$slots:{default:!0}}))}function bt(n,e){let t=j(e,["$$slots","$$events","$$legacy","children","sourceLayer"]);Ie(n,ne({type:"hillshade",get"source-layer"(){return e.sourceLayer}},()=>t,{children:(a,i)=>{var r=V(),s=z(r);G(s,()=>e.children??q),P(a,r)},$$slots:{default:!0}}))}function Lt(n,e){B(e,!0);let t=j(e,["$$slots","$$events","$$legacy","position","source"]);const a=se();if(!a.map)throw new Error("Map instance is not initialized.");const i=D(()=>({source:e.source??he().id,...t}));let r=null;y(()=>{var s,v;r&&((s=a.map)==null||s.removeControl(r)),r=new dt.TerrainControl(F(m(i))),(v=a.map)==null||v.addControl(r,e.position)}),ie(()=>{var s;r&&((s=a.map)==null||s.removeControl(r))}),Y()}var St=U('<div class="menu svelte-xhgsxv"><h2>PMTiles Viewer</h2> <form class="svelte-xhgsxv"><div><label class="title svelte-xhgsxv" for="rgb">RGB (raster)</label> <input id="rgb" type="file"></div> <div><label class="title svelte-xhgsxv" for="height">Height (raster-dem)</label> <input id="height" type="file"></div> <div><label class="title svelte-xhgsxv" for="nan">NaNs (raster)</label> <input id="nan" type="file"></div></form> <button>Load</button></div>');function Ct(n,e){let t=Z(e,"files",15),a=Z(e,"files_dem",15),i=Z(e,"files_overlay",15),r=A(-1);var s=St(),v=M(X(s),2),f=X(v),h=M(X(f),2);N(f);var o=M(f,2),d=M(X(o),2);N(o);var l=M(o,2),u=M(X(l),2);N(l),N(v);var c=M(v,2);c.__click=function(...x){var S;(S=e.loaded)==null||S.apply(this,x)},N(s),at(()=>{ue(h,`${(m(r)===0?"dragged":"")??""} svelte-xhgsxv`),ue(d,`${(m(r)===1?"dragged":"")??""} svelte-xhgsxv`),ue(u,`${(m(r)===2?"dragged":"")??""} svelte-xhgsxv`)}),R("dragenter",h,()=>C(r,0)),R("dragover",h,()=>C(r,0)),R("dragleave",h,()=>C(r,-1)),R("drop",h,()=>C(r,0)),ce(h,t),R("dragenter",d,()=>C(r,1)),R("dragover",d,()=>C(r,1)),R("dragleave",d,()=>C(r,-1)),R("drop",d,()=>C(r,1)),ce(d,a),R("dragenter",u,()=>C(r,2)),R("dragover",u,()=>C(r,2)),R("dragleave",u,()=>C(r,-1)),R("drop",u,()=>C(r,2)),ce(u,i),P(n,s)}nt(["click"]);var Q,p,re,ve,me;class fe{constructor(e){I(this,Q,A(T([])));I(this,p,A());I(this,re,D(()=>{var e,t;return`pmtiles://${(t=(e=this.pmtiles)==null?void 0:e.source)==null?void 0:t.getKey()}`}));I(this,ve,A(T({})));I(this,me,A(T({})));e&&(this.files=e)}get pmtiles(){return m(E(this,p))}set pmtiles(e){C(E(this,p),T(e))}get url(){return m(E(this,re))}set files(e){C(E(this,Q),T(e)),e.length&&(this.pmtiles=new ut(new ct(e[0])))}get files(){return m(E(this,Q))}get header(){var e;return(e=this.pmtiles)==null?void 0:e.getHeader()}get metadata(){var e;return(e=this.pmtiles)==null?void 0:e.getMetadata()}}Q=new WeakMap,p=new WeakMap,re=new WeakMap,ve=new WeakMap,me=new WeakMap;var $,ee,te;class Pt{constructor(){I(this,$,A(T(new fe)));I(this,ee,A(T(new fe)));I(this,te,A(T(new fe)))}get raster(){return m(E(this,$))}set raster(e){C(E(this,$),T(e))}get raster_dem(){return m(E(this,ee))}set raster_dem(e){C(E(this,ee),T(e))}get raster_overlay(){return m(E(this,te))}set raster_overlay(e){C(E(this,te),T(e))}}$=new WeakMap,ee=new WeakMap,te=new WeakMap;var Tt=U("<!> <!>",1),kt=U("<!> <!> <!> <!>",1),zt=U("<p>Loading...</p>");function Et(n,e){B(e,!0);let t=Z(e,"mapProps",15);async function a(){var l,u,c,x,S,_;const s=await((l=e.data)==null?void 0:l.raster.header),v=await((u=e.data)==null?void 0:u.raster.metadata),f=await((c=e.data)==null?void 0:c.raster_dem.header),h=await((x=e.data)==null?void 0:x.raster_dem.metadata),o=await((S=e.data)==null?void 0:S.raster.header),d=await((_=e.data)==null?void 0:_.raster.metadata);return{raster_header:s,raster_metadata:v,raster_dem_header:f,raster_dem_metadata:h,raster_overlay_header:o,raster_overlay_metadata:d}}var i=V(),r=z(i);ft(r,a,s=>{var v=zt();P(s,v)},(s,v)=>{vt(s,{inlineStyle:"height: var(--height); width: var(--width); margin: 0px; background-color: gray;",hash:!0,renderWorldCopies:!1,maxPitch:87,aroundCenter:!1,get center(){return t().center},set center(f){t(t().center=f,!0)},get zoom(){return t().zoom},set zoom(f){t(t().zoom=f,!0)},get bearing(){return t().bearing},set bearing(f){t(t().bearing=f,!0)},get pitch(){return t().pitch},set pitch(f){t(t().pitch=f,!0)},get roll(){return t().roll},set roll(f){t(t().roll=f,!0)},get elevation(){return t().elevation},set elevation(f){t(t().elevation=f,!0)},children:(f,h)=>{var o=kt(),d=z(o);const l=D(()=>{var g;return(g=e.data)==null?void 0:g.raster.url});Se(d,{get url(){return m(l)},children:(g,b)=>{Pe(g,{layout:{},paint:{"raster-resampling":"nearest"}})},$$slots:{default:!0}});var u=M(d,2);const c=D(()=>{var g;return(g=e.data)==null?void 0:g.raster_dem.url});Ce(u,{id:"terrain",get url(){return m(c)},encoding:"custom",baseShift:0,redFactor:256*256,greenFactor:256,blueFactor:1,children:(g,b)=>{var L=Tt(),J=z(L);Lt(J,{position:"top-right"});var K=M(J,2);xt(K,{exaggeration:10}),P(g,L)},$$slots:{default:!0}});var x=M(u,2);const S=D(()=>{var g;return(g=e.data)==null?void 0:g.raster_dem.url});Ce(x,{id:"hillshade",get url(){return m(S)},encoding:"custom",baseShift:0,redFactor:256*256,greenFactor:256,blueFactor:1,children:(g,b)=>{bt(g,{paint:{"hillshade-exaggeration":1,"hillshade-shadow-color":"#000000","hillshade-accent-color":"#00000080","hillshade-highlight-color":"#ffffff00","hillshade-illumination-anchor":"map","hillshade-illumination-direction":0}})},$$slots:{default:!0}});var _=M(x,2);const w=D(()=>{var g;return(g=e.data)==null?void 0:g.raster_overlay.url});Se(_,{get url(){return m(w)},children:(g,b)=>{Pe(g,{layout:{},paint:{"raster-resampling":"nearest"}})},$$slots:{default:!0}}),P(f,o)},$$slots:{default:!0}})}),P(n,i),Y()}var Rt=U('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Mt=U('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ft=U('<!> <div class="main svelte-nc8gtl"></div>',1);function Ut(n,e){B(e,!0);let t=T([!1,!1]),a=2,i=D(()=>{let d=[];for(let l=0;l<a;l++)d.push(new Pt);return d}),r=D(()=>{let d=[];for(let l=0;l<a;l++)m(i)[l].raster.files.length&&d.push(m(i)[l].raster.pmtiles),m(i)[l].raster_dem.files.length&&d.push(m(i)[l].raster_dem.pmtiles),m(i)[l].raster_overlay.files.length&&d.push(m(i)[l].raster_overlay.pmtiles);return d}),s=A(T({}));var v=Ft(),f=z(v);{var h=d=>{mt(d,{get pmtiles(){return m(r)}})};xe(f,d=>{t.some(l=>l===!0)&&d(h)})}var o=M(f,2);yt(o,21,()=>m(i),ht,(d,l,u)=>{var c=V(),x=z(c);{var S=w=>{var g=Rt(),b=z(g);be(b,()=>({"--height":"100%","--width":"100%"})),Et(b.lastChild,{get data(){return m(i)[u]},get mapProps(){return m(s)},set mapProps(L){C(s,T(L))}}),N(b),P(w,g)},_=w=>{var g=Mt(),b=z(g);be(b,()=>({"--width":"300px"})),Ct(b.lastChild,{loaded:()=>t[u]=!t[u],get files(){return m(i)[u].raster.files},set files(L){m(i)[u].raster.files=L},get files_dem(){return m(i)[u].raster_dem.files},set files_dem(L){m(i)[u].raster_dem.files=L},get files_overlay(){return m(i)[u].raster_overlay.files},set files_overlay(L){m(i)[u].raster_overlay.files=L}}),N(b),P(w,g)};xe(x,w=>{t[u]?w(S):w(_,!1)})}P(d,c)}),N(o),P(n,v),Y()}export{Ut as component};
